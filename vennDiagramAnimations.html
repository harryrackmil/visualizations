<!DOCTYPE html>
<html>

	<head>
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://d3js.org/d3.hexbin.v0.min.js?5c6e4f0"></script>
		<script src="venn.js"></script>
		
	</head>
	<body>
		<svg class="diag" x=0 y=0 height=700 width=1200></svg>
	</body>
		<script type="text/javascript">
		
			// MODEL PARAMETERS
			var prodAwareSpaceSize = 2000; //from topic size
			var brands = ['Microsoft', 'Apple', 'Amazon']; //company + competitiors
			var brandAwareSpaceSize = [300, 700, 400]; //number of articles with company mentions
			var brandOverlaps = [[[1,2], 100], [[1, 3], 100], [[2, 3], 200]]; // number of articles with mentions of each pair (overlaps of 3 or more circles make visual better but not strictly necessary
			
			growthrates = [50, 50, 100]; //input by user
			//
			
			
			var indexOfLst = function(lst, el)
			{
				for (k = 0; k < lst.length; k++)
				{
					if (lst[k][0][0] == el[0] && lst[k][0][1] == el[1])
					{
						return k;
					};
				};
				return -1;
				
			}
			var future = 0;
			var simpleGrowth = function()
			{
				prodAwareSpaceSize += d3.sum(growthrates); 
				for (i = 0; i < growthrates.length; i++)
				{
					brandAwareSpaceSize[i] += growthrates[i];
				};
				for (i = 1; i < (growthrates.length + 1); i++)
				{
					for (j = (i + 1); j < (growthrates.length + 1); j++)
					{
						ovIndex = indexOfLst(brandOverlaps, [i, j]);
						overInc = brandOverlaps[ovIndex][1] * (growthrates[i - 1]/brandAwareSpaceSize[i - 1] + growthrates[j - 1]/brandAwareSpaceSize[j - 1]); 
						brandOverlaps[ovIndex][1] += overInc;
						//prodAwareSpaceSize -= overInc;
					};
				};
				circs = getVennObj(prodAwareSpaceSize, brands, brandAwareSpaceSize, brandOverlaps);
				venn.updateD3Diagram(d3.select(".diag"), circs);
				future++;
			}
 
			
			var getVennObj = function(prodAwareSpaceSize, brands, brandAwareSpaceSize, brandOverlaps)
			{
				var set = [];
				var overlaps = [];
				for (i = 0; i < brands.length; i++)
				{
					set[set.length] = {label:brands[i], size:brandAwareSpaceSize[i]};
					overlaps[overlaps.length] = {sets:[0, i + 1], size:brandAwareSpaceSize[i]};
				};
				for (i = 0; i < brandOverlaps.length; i++)
				{
					overlaps[overlaps.length] = {sets: brandOverlaps[i][0], size: brandOverlaps[i][1]};
				};
				set.unshift({label: "Product Aware", size: prodAwareSpaceSize});
				return venn.venn(set, overlaps);
			}			
			
			func = d3.scale.category10(); 
			var props = {circleFillColours: function(i){ if (i > 0) {return func(i);} else {return "white";}},
						textFillColours: function(i){ if (i > 0) {return func(i);} else {return "black";}},
						circleStrokeColours: function(i){ if (i > 0) {return func(i);} else {return "black";}},
						circleStrokeWidth: function(i) { if (i > 0) {return 0; } else {return 1;};}};
						
						

	
			circs = getVennObj(prodAwareSpaceSize, brands, brandAwareSpaceSize, brandOverlaps);
			venn.drawD3Diagram(d3.select(".diag"), circs, 400, 400, props);
			

			interval = setInterval(simpleGrowth, 500);

			d3.selectAll("svg").on("click", function()
											{
												clearInterval(interval);
											});
		</script>
</html>